\documentclass{article}
\usepackage{a4wide}
\usepackage[utf8]{inputenc} %             be able to use danish letters
\usepackage[danish]{babel} %                and danish macros
\usepackage{url}                            %, hyperref} hyperref makes clickable refs.
\usepackage{amsmath}
\renewcommand\sfdefault{phv}%               use helvetica for sans serif
\renewcommand\familydefault{\sfdefault}%    use sans serif by default
\setlength{\parskip}{2mm plus1mm minus1mm}% a bit of (rubber) space between paragraphs

\author{Lars Vensild Hørnell \and Søren Mollerup \and Steen
  Manniche\thanks{\{lvh, shm, stm\}\@dbc.dk}}
\date{\today}
\title{Use case: Transformation af data og metadata til XML\thanks{Dette dokument kan hentes fra \texttt{svn://svn.dbc.dk/OpenSearch/project\_information}}}

\begin{document}

\maketitle

\newpage

\tableofcontents
% Det er hensigten, at alle informationer der er i < eller > tegn skal
% slettes inden dokumentet bygges

\section{Use case beskrivelse}
Denne usecase dækker transformationen af det 'rå' inddata til XML der
konformerer til et indekseringsparat format ift. Compass/Lucene.
Transformationen i PTI er en central funktionalitet, der skal sørge
for at formattere det indsendte data til XML, der kan indekseres.

Udfra mimetypen findes en Handler der kan udføre transformationen. For
en given mimetype kan der eksistere flere Handlers. Hvis der
eksisterer flere Handlers, bestemmes de udfra mimetype samt
indsender. Det kan være tilfældet hvis indsenderens format er ensartet
og velkendt.

Det er Transformationens ansvar at vælge den korrekte Handler eller
fejle hvis ikke den kan finde en (det \textit{burde} ikke kunne ske,
men man ved jo aldrig).

Handlerobjekterne danner basis for generering af valideringsobjekterne
som bruges i valideringsfasen. Når nye Handlers bliver tilføjet, eller
allerede eksisterende Handlers bliver ændret, skal der dannes nye
valideringsobjekter der kan bruges i valideringsfasen.

Administration af Handlers, understøttede sprog, tegnsæt og mime-typer
foregår gennem et API, PTI komponentet stiller til rådighed.

\section{Type}
Konkret

\section{Relationer}
PTI-validering\_af\_data\_til\_indexering


\section{Aktører}
\begin{itemize}
\item \texttt{PTI}
\end{itemize}

\section{Forudsætninger}

Data skal være hentet fra fedora repositoriet og der skal være
foretaget en validering af metadata.mimetype (for at kunne vælge den
korrekte TransformationsHandler).

\section{Initiering}
<Hvorfor og hvordan use casen startes, som regel af en aktør>
\texttt{PTI} har hentet data fra fedora og har valideret
metadata. Hvis disse handlinger går godt, igangsættes
transformationen.

\section{Beskrivelse}
\begin{enumerate}
\item Udfra metadatas beskrivelse af mimetypen specificeres en passende Handler.
\item [Exception] der kan ikke findes en handler for den givne mimetype
\item Transformationen igangsættes
  \begin{enumerate}
  \item der foretages en konversion fra inddatas format til XML
  \item evt. andre datakilder hentes ind
  \item metadata og evt. andre datakilder flettes ind i XML

  \item [javax.xml.transformer.TransformerException] hvis fletning gik galt
  \end{enumerate}
\item validering af det endelige XML ift. Compass/Lucene
  indexeringsschema. Se use casen
  PTI-validering\_af\_data\_til\_indexering
\item [javax.xml.validation.SAXException] hvis XML ikke validerer
\item data videregives til indexering
\end{enumerate}

\section{Terminationstilstande}

\subsection{Succes}
XML validerer og gives videre til indexering

\subsection{Exception}

\begin{itemize}
\item Der eksisterer ikke en handler for den givne mimetype
\item fletning af data med metadata og/eller ekstern data fejlede
\item Data validerer ikke
\end{itemize}


\section{Status på use case}
Vi mangler at afklare hvilken exception der skal kastes hvis handleren for mimetypen ikke findes

\end{document}
